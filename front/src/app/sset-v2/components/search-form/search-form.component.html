<section class="s-search-form pb-5">
  <p class="p-intro">
    <span
      [innerHTML]="'SSET_V2.INSTRUCTION' | translate | translateCut : 0"
    ></span>
    <button
      class="btn btn-link"
      data-analytics-track="sset"
      data-analytics-val="faq>ticket number"
      tabindex="0"
      [innerHTML]="'SSET_V2.INSTRUCTION' | translate | translateCut : 1"
      (click)="openModal(ticketNumberModal)"
    ></button>
    <span
      [innerHTML]="'SSET_V2.INSTRUCTION' | translate | translateCut : 2"
    ></span>
  </p>
  <form (ngSubmit)="onSearch($event)" [formGroup]="form" autocomplete="off">
    <div class="row">
      <div class="col">
        <div class="row">
          <div class="col-12 col-sm-6 col-md-6 col-lg-4-7">
            <div class="form-label-group">
              <input
                appTrim
                class="form-control"
                formControlName="ticket"
                id="ticket-number"
                oninput="this.value = this.value.toUpperCase()"
                placeholder="&nbsp;"
                type="text"
              />
              <label
                for="ticket-number"
                [innerHTML]="'SSET_V2.SEARCH.TICKET_LABEL' | translate"
              ></label>
              <ng-template #ticketHelp>
                <div class="help-block black">
                  {{ 'SSET_V2.SEARCH.TICKET_HELP' | translate }}
                </div>
              </ng-template>
              <div
                *ngIf="
                  form.controls.ticket.errors &&
                    form.controls.ticket.dirty &&
                    form.controls.ticket.touched;
                  else ticketHelp
                "
                class="help-block error"
              >
                <div
                  *ngIf="
                    form.controls.ticket.errors['required'] ||
                    form.controls.ticket.hasError('1090005')
                  "
                >
                  {{ 'SSET_V2.SEARCH.ERRORS.TICKET_REQUIRED' | translate }}
                </div>
                <div
                  *ngIf="
                    !(
                      form.controls.ticket.errors['required'] ||
                      form.controls.ticket.hasError('1090005')
                    ) &&
                    (form.controls.ticket.errors['pattern'] ||
                      form.controls.ticket.hasError('1010005') ||
                      form.controls.ticket.hasError('1010015') ||
                      form.controls.ticket.hasError('1020015') ||
                      form.controls.ticket.errors['invalidInputLength'] ||
                      form.controls.ticket.hasError('1010050') ||
                      form.controls.ticket.hasError('1010010') ||
                      form.controls.ticket.hasError('1020005') ||
                      form.controls.ticket.hasError('1020010'))
                  "
                >
                  {{ 'SSET_V2.SEARCH.ERRORS.TICKET_VALIDATION' | translate }}
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-sm-6 col-md-6 col-lg-4-7">
            <div class="form-label-group">
              <input
                appTrim
                class="form-control"
                formControlName="lastName"
                id="last-name"
                placeholder=" "
                type="text"
              />
              <label for="last-name">{{
                'SSET_V2.SEARCH.LASTNAME_LABEL' | translate
              }}</label>

              <ng-template #lastnameHelp>
                <div class="help-block black">
                  {{ 'SSET_V2.SEARCH.LASTNAME_HELP' | translate }}
                </div>
              </ng-template>

              <div
                *ngIf="
                  form.controls.lastName.errors &&
                    form.controls.lastName.dirty &&
                    form.controls.lastName.touched;
                  else lastnameHelp
                "
                class="help-block error"
              >
                <div
                  *ngIf="
                    form.controls.lastName.errors['required'] ||
                    form.controls.lastName.hasError('1050010')
                  "
                >
                  {{ 'SSET_V2.SEARCH.ERRORS.LASTNAME_REQUIRED' | translate }}
                </div>
                <div
                  *ngIf="
                    form.controls.lastName.errors['pattern'] ||
                    form.controls.lastName.hasError('1050015')
                  "
                >
                  {{ 'SSET_V2.SEARCH.ERRORS.LASTNAME_PATTERN' | translate }}
                </div>
                <div
                  *ngIf="
                    form.controls.lastName.errors['maxlength'] ||
                    form.controls.lastName.hasError('1050005')
                  "
                >
                  {{ 'SSET_V2.SEARCH.ERRORS.LASTNAME_MAXLENGTH' | translate }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="w-100"></div>
      <div class="col-sm-6 col-md-6 col-lg-4-7">
        <button
          [attr.aria-disabled]="disableBtn"
          [class.disabled]="disableBtn"
          class="btn btn-secondary btn-search has-loading-spinner"
          data-analytics-track="sset"
          data-analytics-val="find booking or ticket"
          onclick="this.blur()"
          type="submit"
        >
          {{ 'SSET_V2.SEARCH.BTN_SEARCH' | translate }}
          <span *ngIf="store.loading$ | async" class="loading-spinner">
            <span
              aria-hidden="true"
              class="spinner-border spinner-border-sm"
              role="status"
            ></span>
            <span class="sr-only">{{ 'SHARED.LOADING' | translate }}</span>
          </span>
        </button>
      </div>
    </div>
  </form>
</section>

<ng-template #ticketNumberModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">
      {{ 'SSET_V2.FIND_TICKET.TITLE' | translate }}
    </h4>
    <button
      aria-label="Close"
      class="close"
      type="button"
      (click)="modalRef.hide()"
    >
      <svg class="icn icn-close" role="presentation" type="button">
        <title>{{ 'ICON_TITLE.CLOSE' | translate }}</title>
        <use xlink:href="/assets/icons.svg#icn-close"></use>
      </svg>
    </button>
  </div>
  <div class="modal-body">
    <p>{{ 'SSET_V2.FIND_TICKET.BODY' | translate }}</p>
    <img
      src="/assets/img/ticket_number.jpg"
      [alt]="'SSET_V2.FIND_TICKET.CAPTION' | translate"
    />
  </div>
</ng-template>
